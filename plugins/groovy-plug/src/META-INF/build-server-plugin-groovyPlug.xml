<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                           http://www.springframework.org/schema/lang
                           http://www.springframework.org/schema/lang/spring-lang-2.0.xsd"
       default-autowire="constructor">

    <bean id="customProps" class="jetbrains.buildserver.groovyPlug.CustomSubstitutionProperties">
        <property name="groovyPlugScriptsDirPropertyName" value="groovyplug.dir"/>
        <property name="groovyPlugScriptsDir" value="__groovyPlug__"/>
    </bean>

    <bean class="jetbrains.buildserver.groovyPlug.GroovyScriptsPreparer">
        <property name="mySourceResourceDir" value="/jetbrains/buildserver/groovyPlug"/>
        <property name="mySourceFileName" value="GroovyPropertyProvider.groovy"/>
        <property name="myTargetDir" value="${groovyplug.dir}"/>
        <property name="myTargetFileName" value="GroovyPropertyProvider.groovy"/>
    </bean>

    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="properties" ref="customProps"/>
    </bean>

    <lang:groovy id="groovyPropertyProvider" refresh-check-delay="5000"
                 script-source="file:/${groovyplug.dir}/GroovyPropertyProvider.groovy">
        <lang:property name="vcsModificationHistory" ref="dbVcsModificationHistory"/>
    </lang:groovy>

    <bean class="jetbrains.buildserver.groovyPlug.GroovyPropertyProviderInitializer">
        <constructor-arg index="0" ref="groovyPropertyProvider"/>
        <constructor-arg index="1" ref="buildServer"/>
    </bean>

</beans>